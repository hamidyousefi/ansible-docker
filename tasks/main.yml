---
- name: installing necessary packages
  apt:
    name:
      - apt-transport-https
      - ca-certificates
      - curl
      - gnupg-agent
      - software-properties-common
    update_cache: yes
    state: present
    force_apt_get: yes
  when: ansible_distribution == 'Ubuntu' or ansible_distribution == 'Debian'

- include: distributions/debian.yml
  when: ansible_distribution == 'Debian'

- include: distributions/ubuntu.yml
  when: ansible_distribution == 'Ubuntu'

- include: compose.yml
  when: configure.compose

- name: configure proxy if defined
  block:
    - name: create systemd necessary directory
      file:
        path: /etc/systemd/system/docker.service.d
        state: directory
        owner: root
        group: root
        mode: '0755'

    - name: create systemd service config file
      template:
        src: proxy.conf.j2
        dest: /etc/systemd/system/docker.service.d/proxy.conf
        owner: root
        group: root
        mode: '0644'
  when: configure.proxy

- include: iptables.yml
  when: configure.iptables
